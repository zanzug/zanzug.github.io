<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Our Mood Avatars</title>
  <style>
    :root {
      --pink: #ffb6c1;
      --dark-bg: #0d0d0d;
      --medium-bg: #1a1a1a;
      --border: #ff69b4;
    }
    
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 15px;
      background: var(--dark-bg);
      color: white;
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    h1 {
      color: var(--pink);
      margin: 0 0 20px;
      font-size: 24px;
    }
    
    .avatars-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .avatar-card {
      background: var(--medium-bg);
      border: 2px solid var(--border);
      border-radius: 15px;
      padding: 15px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto;
    }
    
    .avatar-name {
      color: var(--pink);
      margin: 0 0 10px;
      font-size: 18px;
    }
    
    .avatar-image-container {
      width: 150px;
      height: 150px;
      margin: 0 auto;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      background: black;
    }
    
    .avatar-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.3s;
    }
    
    .mood-text {
      margin-top: 10px;
      font-size: 14px;
      color: var(--pink);
      min-height: 20px;
    }
    
    .mood-controls {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .mood-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      font-size: 20px;
      background: var(--medium-bg);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    
    .mood-btn.selected {
      transform: scale(1.1);
      box-shadow: 0 0 0 2px var(--pink);
    }
    
    .back-btn {
      background: var(--medium-bg);
      border: 1px solid var(--pink);
      color: var(--pink);
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      margin-top: auto;
      cursor: pointer;
      width: 100%;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--pink);
    }
    
    /* iPhone notch/punch-hole safe areas */
    @supports (padding: max(0px)) {
      body {
        padding-left: max(15px, env(safe-area-inset-left));
        padding-right: max(15px, env(safe-area-inset-right));
        padding-bottom: max(15px, env(safe-area-inset-bottom));
      }
    }
  </style>
</head>
<body>
  <h1>Our Mood Avatars</h1>
  
  <div class="avatars-container">
    <!-- Zuzanna's Avatar -->
    <div class="avatar-card">
      <h2 class="avatar-name">Zuzanna</h2>
      <div class="avatar-image-container">
        <div class="loading">Loading...</div>
        <img id="zuzanna-avatar" class="avatar-image" style="display: none;">
      </div>
      <div id="zuzanna-mood" class="mood-text">Mood: Not set</div>
    </div>
    
    <!-- Elisha's Avatar -->
    <div class="avatar-card">
      <h2 class="avatar-name">Elisha</h2>
      <div class="avatar-image-container">
        <div class="loading">Loading...</div>
        <img id="elisha-avatar" class="avatar-image" style="display: none;">
      </div>
      <div id="elisha-mood" class="mood-text">Mood: Not set</div>
      
      <!-- Mood selector only for Elisha -->
      <div class="mood-controls" id="elisha-mood-controls">
        <button class="mood-btn" data-mood="happy">üòä</button>
        <button class="mood-btn" data-mood="loved">ü•∞</button>
        <button class="mood-btn" data-mood="silly">üòú</button>
        <button class="mood-btn" data-mood="calm">üòå</button>
        <button class="mood-btn" data-mood="sad">üò¢</button>
        <button class="mood-btn" data-mood="angry">üò†</button>
      </div>
    </div>
  </div>
  
  <button class="back-btn" onclick="window.location.href='index.html'">‚Üê Back to Main</button>

  <script type="module">
    // Replace these with your actual image paths
    const zuzannaImages = {
      happy: "images/zhappy.jpg",
      loved: "images/zuzanna-loved.jpg",
      silly: "images/zuzanna-silly.jpg",
      calm: "images/zuzanna-calm.jpg",
      sad: "images/zuzanna-sad.jpg",
      angry: "images/zuzanna-angry.jpg",
      default: "images/zuzanna-default.jpg"
    };
    
    const elishaImages = {
      happy: "images/elisha-happy.jpg",
      loved: "images/elisha-loved.jpg",
      silly: "images/elisha-silly.jpg",
      calm: "images/elisha-calm.jpg",
      sad: "images/elisha-sad.jpg",
      angry: "images/elisha-angry.jpg",
      default: "images/elisha-default.jpg"
    };
    
    const moodMessages = {
      happy: "is happy üòä",
      loved: "is feeling loved ü•∞",
      silly: "is being silly üòú",
      calm: "is calm üòå",
      sad: "is sad üò¢",
      angry: "is angry üò†",
      default: "hasn't set a mood yet"
    };

    // Firebase setup (same as your main page)
    const firebaseConfig = {
      apiKey: "AIzaSyC9FlIiG_8gDHAH-5SnmmnL_vAJTMSySIo",
      authDomain: "chat-e7c75.firebaseapp.com",
      databaseURL: "https://chat-e7c75-default-rtdb.firebaseio.com",
      projectId: "chat-e7c75",
      storageBucket: "chat-e7c75.appspot.com",
      messagingSenderId: "340780127879",
      appId: "1:340780127879:web:5f18ff2fb8d8f12af7ca22",
      measurementId: "G-TWS5HLPZDE"
    };

    // Initialize Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // DOM elements
    const zuzannaAvatar = document.getElementById('zuzanna-avatar');
    const elishaAvatar = document.getElementById('elisha-avatar');
    const zuzannaMoodText = document.getElementById('zuzanna-mood');
    const elishaMoodText = document.getElementById('elisha-mood');
    const moodButtons = document.querySelectorAll('.mood-btn');

    // Load avatar image with fallback
    function loadAvatar(imgElement, images, mood) {
      const img = new Image();
      img.onload = () => {
        imgElement.src = img.src;
        imgElement.style.display = 'block';
        imgElement.parentElement.querySelector('.loading').style.display = 'none';
      };
      img.onerror = () => {
        imgElement.src = images.default;
        imgElement.style.display = 'block';
        imgElement.parentElement.querySelector('.loading').style.display = 'none';
      };
      img.src = images[mood] || images.default;
    }

    // Update mood display
    function updateMoodDisplay(user, mood) {
      if (user === 'zuzanna') {
        zuzannaMoodText.textContent = `Zuzanna ${moodMessages[mood] || moodMessages.default}`;
        loadAvatar(zuzannaAvatar, zuzannaImages, mood);
      } else {
        elishaMoodText.textContent = `Elisha ${moodMessages[mood] || moodMessages.default}`;
        loadAvatar(elishaAvatar, elishaImages, mood);
        
        // Update selected button
        moodButtons.forEach(btn => {
          btn.classList.toggle('selected', btn.dataset.mood === mood);
        });
      }
    }

    // Set up mood listeners
    function setupMoodListeners() {
      // Listen for Zuzanna's mood changes
      onValue(ref(database, 'zuzanna_mood'), (snapshot) => {
        const moodData = snapshot.val();
        updateMoodDisplay('zuzanna', moodData?.mood || 'default');
      });

      // Listen for Elisha's mood changes
      onValue(ref(database, 'elisha_mood'), (snapshot) => {
        const moodData = snapshot.val();
        updateMoodDisplay('elisha', moodData?.mood || 'default');
      });
    }

    // Set mood function
    function setMood(mood) {
      set(ref(database, 'elisha_mood'), {
        mood: mood,
        timestamp: new Date().getTime()
      });
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', () => {
      // Set up mood buttons
      moodButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          setMood(btn.dataset.mood);
        });
      });

      // Set up Firebase listeners
      setupMoodListeners();

      // Load default avatars
      loadAvatar(zuzannaAvatar, zuzannaImages, 'default');
      loadAvatar(elishaAvatar, elishaImages, 'default');
    });

    // Prevent zooming on iOS
    document.addEventListener('touchmove', function(e) {
      if (e.scale !== 1) { e.preventDefault(); }
    }, { passive: false });
  </script>
</body>
</html>