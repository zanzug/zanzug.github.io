<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Love Letter Portal</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: #fff0f5;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    #recipient-info {
      padding: 10px;
      margin-bottom: 15px;
      background: #ffe6ee;
      border-radius: 5px;
      display: none;
    }
  </style>
</head>
<body>
  <h1>üíå Send Love Letter</h1>
  <div id="recipient-info"></div>
  <textarea id="message" placeholder="Type your message..." rows="5"></textarea>
  <button id="sendBtn">Send Secret Message</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC9FlIiG_8gDHAH-5SnmmnL_vAJTMSySIo",
      authDomain: "chat-e7c75.firebaseapp.com",
      databaseURL: "https://chat-e7c75-default-rtdb.firebaseio.com",
      projectId: "chat-e7c75",
      storageBucket: "chat-e7c75.appspot.com",
      messagingSenderId: "340780127879",
      appId: "1:340780127879:web:5f18ff2fb8d8f12af7ca22"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // Sign in automatically (replace with your auth flow)
    auth.signInWithEmailAndPassword('tsitalashes@gmail.com', 'your_password')
      .catch(error => console.error("Auth error:", error));

    document.getElementById('sendBtn').addEventListener('click', async () => {
      const message = document.getElementById('message').value.trim();
      if (!message) return alert("Please write a message!");

      const user = auth.currentUser;
      if (!user) return alert("Please sign in first!");

      try {
        // Determine recipient email
        let recipientEmail;
        switch(user.email) {
          case 'zuzannap871@gmail.com':
          case 'psychologyet@gmail.com':
            recipientEmail = 'elisha878@hotmail.com';
            break;
          default:
            recipientEmail = 'zuzannap871@gmail.com'; // Default to Zuzanna
        }

        // Save to Firebase
        const newMsgRef = db.ref('love_messages').push();
        await newMsgRef.set({
          text: message,
          from: user.email,
          to: recipientEmail,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          read: false
        });

        // Show recipient info
        const infoEl = document.getElementById('recipient-info');
        infoEl.innerHTML = `‚úâÔ∏è Will be sent to: <strong>${recipientEmail}</strong>`;
        infoEl.style.display = 'block';

        // Open email client
        const subject = "üíå Secret Love Letter";
        const body = `Your message: ${message}\n\nReply to: ${user.email}`;
        window.open(`mailto:${recipientEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);

      } catch (error) {
        console.error("Send failed:", error);
        alert("Error sending message. Check console for details.");
      }
    });

    // Auto-detect sender email
    auth.onAuthStateChanged(user => {
      if (user) {
        console.log("Logged in as:", user.email);
        const infoEl = document.getElementById('recipient-info');
        if (user.email === 'zuzannap871@gmail.com' || user.email === 'psychologyet@gmail.com') {
          infoEl.innerHTML = "‚úâÔ∏è <strong>Note:</strong> Your messages will be sent to Elisha's email";
        } else {
          infoEl.innerHTML = "‚úâÔ∏è <strong>Note:</strong> Your messages will be sent to Zuzanna's email";
        }
        infoEl.style.display = 'block';
      }
    });
  </script>
</body>
</html>